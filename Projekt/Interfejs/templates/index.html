<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Scraper książek</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <header>Scraper </header>

<main>
  <form method="post" class="filters scrape-form">
    <label>Dodaj książki z linku:</label>
    <input type="text" name="scrape_url" placeholder="https://books.toscrape.com/">
    <br>
    <button type="submit">Scrapuj</button>
  </form>

  <form method="get" class="filters sort-filter-form" id="sortForm">
    <label>Sortuj wg:</label>
    <select name="sort">
      <option value="">-- wybierz --</option>
      <option value="name-asc">Nazwa A-Z</option>
      <option value="name-desc">Nazwa Z-A</option>
      <option value="price-asc">Cena rosnąco</option>
      <option value="price-desc">Cena malejąco</option>
      <option value="amount-asc">Ilość rosnąco</option>
      <option value="amount-desc">Ilość malejąco</option>
    </select>

    <label>Kategoria:</label>
    <input type="text" name="category" placeholder="np. survivalowa">
    <button type="submit">Filtruj</button>
  </form>

  <div class="book-grid">
    {% for book in books %}
    <div class="book">
      {% if book.image_url %}
      <div class="book-image">
        <img src="{{ book.image_url }}" alt="{{ book.title }}">
      </div>
      {% endif %}
      <div class="title">{{ book.title }}</div>
      <div class="category">Kategoria: {{ book.category }}</div>
      <div class="amount">Ilość: {{ book.amount }}</div>
      <div class="price">Cena: {{ "%.2f"|format(book.price) }} zł</div>

      <!-- FORMULARZ USUWANIA -->
      <form method="post" action="{{ url_for('delete_book') }}" onsubmit="return confirm('Czy na pewno chcesz usunąć tę książkę?');">
        <input type="hidden" name="key" value="{{ book.redis_key }}">
        <button type="submit" class="delete-button">Usuń</button>
      </form>
    </div>
    {% endfor %}
  </div>
</main>

  <footer>
    Autorzy: Kacper Woszczyło 21324 oraz Michał Lepak 21255
  </footer>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const sortSelect = document.querySelector('select[name="sort"]');
      sortSelect.addEventListener('change', function () {
        document.getElementById('sortForm').submit();
      });
    });
  </script>
</body>
</html>
